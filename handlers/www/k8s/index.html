<!doctype html>
<html ng-app="DockerPlay" ng-controller="PlayController">
    <head>
        <title>Kubernetes Playground</title>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic|Material+Icons" />
        <link rel="stylesheet" href="https://unpkg.com/angular-material@1.1.10/angular-material.min.css">
        <link rel="stylesheet" href="/assets/xterm/xterm.css" />
         <link rel="stylesheet" href="/assets/xterm/addons/fullscreen/fullscreen.css" />
        <!-- Custom CSS for Kubernetes styling -->
        <style>
            /* Global Kubernetes theme */
            body {
                font-family: 'Roboto', sans-serif;
                margin: 0;
                padding: 0;
                background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
                height: 100vh;
                overflow: hidden;
            }

            /* Header styling */
            .main-header {
                background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
                color: white;
                padding: 16px 24px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                z-index: 1000;
                position: relative;
            }

            .header-left {
                display: flex;
                align-items: center;
                gap: 16px;
            }

            .k8s-logo {
                width: 32px;
                height: 32px;
                background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE2IDJMMjggMTBWMjJMMTYgMzBMNCAyMlYxMEwxNiAyWiIgZmlsbD0iIzMyNkNFNSIvPgo8cGF0aCBkPSJNMTYgNkwyNC44IDEyVjIwTDE2IDI2TDcuMiAyMFYxMkwxNiA2WiIgZmlsbD0id2hpdGUiLz4KPHA+PC9wYXRoPgo8L3N2Zz4K') center/contain no-repeat;
            }

            .header-title {
                font-size: 24px;
                font-weight: 500;
                margin: 0;
            }

            .header-right {
                display: flex;
                align-items: center;
                gap: 16px;
            }

            .timer-display {
                font-family: 'Roboto Mono', monospace;
                font-size: 18px;
                font-weight: bold;
                background: rgba(255,255,255,0.2);
                padding: 8px 16px;
                border-radius: 20px;
                min-width: 80px;
                text-align: center;
            }

            .close-session-btn {
                background: linear-gradient(135deg, #ff5252 0%, #d32f2f 100%) !important;
                color: white !important;
                border: none !important;
                padding: 10px 20px !important;
                border-radius: 6px !important;
                font-weight: 500 !important;
                transition: all 0.3s ease !important;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }

            .close-session-btn:hover {
                background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%) !important;
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(244, 67, 54, 0.3);
            }

            /* Main content layout */
            .main-content {
                display: flex;
                height: calc(100vh - 72px);
            }

            /* Sidebar styling */
            .sidebar {
                width: 300px;
                background: white;
                border-right: 1px solid #e0e0e0;
                display: flex;
                flex-direction: column;
                box-shadow: 2px 0 8px rgba(0,0,0,0.1);
            }

            .sidebar-header {
                padding: 20px;
                border-bottom: 1px solid #e0e0e0;
                background: #f8f9fa;
            }

            .sidebar-title {
                font-size: 18px;
                font-weight: 600;
                margin: 0 0 16px 0;
                color: #1a237e;
                text-align: left;
            }

            .add-instance-btn {
                background: #2e7d32 !important;
                color: white !important;
                width: 100%;
                padding: 12px !important;
                border-radius: 6px !important;
                font-weight: 500 !important;
                transition: all 0.3s ease !important;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }

            .add-instance-btn:hover {
                background: linear-gradient(135deg, #43a047 0%, #1b5e20 100%) !important;
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(76, 175, 80, 0.3);
            }

            .add-instance-btn:disabled {
                background: #cccccc !important;
                transform: none !important;
                box-shadow: none !important;
            }

            .instances-list {
                flex: 1;
                overflow-y: auto;
                padding: 0;
            }

            .instance-item {
                padding: 16px 20px;
                border-bottom: 1px solid #f0f0f0;
                cursor: pointer;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .instance-item:hover {
                background: #f5f5f5;
            }

            .instance-item.selected {
                background: #e3f2fd;
                border-left: 4px solid #1976d2;
            }

            .instance-icon {
                width: 24px;
                height: 24px;
                border-radius: 50%;
                background: #1976d2;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 12px;
                font-weight: bold;
            }

            .instance-icon.manager {
                background: #2196f3;
            }

            .instance-info h3 {
                margin: 0 0 4px 0;
                font-size: 14px;
                font-weight: 600;
                color: #333;
            }

            .instance-info h4 {
                margin: 0;
                font-size: 12px;
                color: #666;
                font-weight: normal;
            }

            /* Terminal area styling */
            .terminal-area {
                flex: 1;
                display: flex;
                flex-direction: column;
                background: white;
            }

            .welcome-screen {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-align: center;
                padding: 40px;
                color: #666;
            }

            .welcome-screen h2 {
                color: #1a237e;
                margin-bottom: 16px;
                font-weight: 500;
            }

            .welcome-screen p {
                margin-bottom: 8px;
                line-height: 1.6;
            }

            .welcome-screen .session-info {
                background: #fff3cd;
                border: 1px solid #ffeaa7;
                border-radius: 8px;
                padding: 16px;
                margin-top: 20px;
                color: #856404;
            }

            /* Instance details card */
            .instance-card {
                background: white;
                margin: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                overflow: hidden;
            }

            .instance-card-header {
                background: #f8f9fa;
                padding: 20px;
                border-bottom: 1px solid #e0e0e0;
            }

            .instance-card-title {
                font-size: 20px;
                font-weight: 600;
                color: #1a237e;
                margin: 0 0 16px 0;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .k8s-disclaimer-btn {
                background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%) !important;
                color: white !important;
                border: none !important;
                padding: 8px 16px !important;
                border-radius: 20px !important;
                font-size: 12px !important;
                font-weight: 500 !important;
                transition: all 0.3s ease !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                cursor: pointer;
            }

            .k8s-disclaimer-btn:hover {
                background: linear-gradient(135deg, #f57c00 0%, #ef6c00 100%) !important;
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(255, 152, 0, 0.3);
            }

            .instance-details {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 16px;
                margin-bottom: 16px;
            }

            .detail-item {
                position: relative;
            }

            .detail-item label {
                display: block;
                font-size: 12px;
                font-weight: 600;
                color: #666;
                margin-bottom: 4px;
                text-transform: uppercase;
            }

            .detail-item input {
                width: 100%;
                padding: 8px 35px 8px 12px;
                border: 1px solid #e0e0e0;
                border-radius: 4px;
                font-size: 14px;
                background: #f8f9fa;
                box-sizing: border-box;
            }

            .copy-btn {
                position: absolute;
                right: 4px;
                top: 22px;
                background: transparent;
                color: #666;
                border: none;
                padding: 4px;
                cursor: pointer;
                font-size: 16px;
                border-radius: 4px;
                width: 19px;
                height: 19px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .copy-btn:hover {
                background: #f0f0f0;
                color: #2196f3;
            }

            .port-chips {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                margin-top: 8px;
            }

            .port-chip {
                background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%);
                color: white;
                padding: 4px 12px;
                border-radius: 16px;
                font-size: 12px;
                font-weight: 500;
                text-decoration: none;
                transition: all 0.2s ease;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .port-chip:hover {
                background: linear-gradient(135deg, #1565c0 0%, #082e61 100%);
                color: white;
                text-decoration: none;
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            }

            .instance-actions {
                padding: 20px;
                border-top: 1px solid #e0e0e0;
                display: flex;
                gap: 12px;
            }

            .delete-instance-btn {
                background: linear-gradient(135deg, #ff5252 0%, #d32f2f 100%) !important;
                color: white !important;
                padding: 10px 20px !important;
                border-radius: 6px !important;
                font-weight: 500 !important;
                transition: all 0.3s ease !important;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }

            .delete-instance-btn:hover {
                background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%) !important;
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(244, 67, 54, 0.3);
            }

            .delete-instance-btn:disabled {
                background: #cccccc !important;
                transform: none !important;
                box-shadow: none !important;
            }

            .cheat-sheet-btn {
                background: linear-gradient(135deg, #2196f3 0%, #1565c0 100%) !important;
                color: white !important;
                padding: 10px 20px !important;
                border-radius: 6px !important;
                font-weight: 500 !important;
                transition: all 0.3s ease !important;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }

            .cheat-sheet-btn:hover {
                background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%) !important;
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(33, 150, 243, 0.3);
            }

            /* Terminal container */
            .terminal-container {
                flex: 1;
                padding: 20px;
                background: #1e1e1e;
                overflow: hidden;
            }

            .terminal-instance {
                width: 100%;
                height: 100%;
                background: #1e1e1e;
            }

            /* Upload progress */
            .upload-status {
                padding: 16px 20px;
                background: #e3f2fd;
                border-bottom: 1px solid #bbdefb;
            }

            /* Session ended screen */
            .session-ended {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                background: white;
            }

            .session-ended-content {
                text-align: center;
                padding: 40px;
            }

            .session-ended h2 {
                color: #f44336;
                margin-bottom: 16px;
            }

            /* Disconnected screen */
            .disconnected {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                color: white;
            }

            .disconnected h1 {
                margin-right: 20px;
            }

            /* Cheat Sheet Styles */
            .cheat-sheet-container {
                display: flex;
                height: 70vh;
                max-height: 700px;
                min-width: 700px;
            }

            .cheat-sidebar {
                width: 250px;
                background: #f5f5f5;
                border-right: 1px solid #e0e0e0;
                overflow-y: auto;
            }

            .cheat-sidebar-item {
                padding: 15px 20px;
                border-bottom: 1px solid #e0e0e0;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .cheat-sidebar-item:hover {
                background: #e3f2fd;
            }

            .cheat-sidebar-item.active {
                background: #bbdefb;
                border-right: 4px solid #2196f3;
            }

            .cheat-content {
                flex: 1;
                padding: 20px;
                overflow-y: auto;
            }

            .cheat-topic {
                margin-bottom: 25px;
            }

            .cheat-topic-title {
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 15px;
                color: #1a237e;
            }

            .cheat-command {
                margin-bottom: 15px;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 6px;
                border-left: 4px solid #2196f3;
            }

            .command-code {
                font-family: 'Roboto Mono', monospace;
                background: #263238;
                color: #e0e0e0;
                padding: 12px;
                border-radius: 4px;
                display: block;
                margin-bottom: 10px;
                position: relative;
                min-width: 600px;
            }

            .command-actions {
                display: flex;
                gap: 10px;
            }

            .command-btn {
                background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                color: white;
                border: none;
                padding: 8px 15px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.2s ease;
            }

            .command-btn:hover {
                background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
                transform: translateY(-1px);
            }

            .command-desc {
                color: #666;
                font-size: 14px;
                margin-bottom: 10px;
            }

            /* Session Timeout Modal */
            .session-timeout-modal {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            }

            .session-timeout-content {
                background: white;
                padding: 30px;
                border-radius: 8px;
                text-align: center;
                max-width: 400px;
                width: 90%;
            }

            .session-timeout-content h2 {
                color: #f44336;
                margin-top: 0;
            }

            .session-timeout-content button {
                background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                margin-top: 20px;
                transition: all 0.2s ease;
            }

            .session-timeout-content button:hover {
                background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
                transform: translateY(-1px);
            }

            /* Kubernetes Disclaimer Modal */
            .k8s-disclaimer-modal {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10001;
            }

            .k8s-disclaimer-content {
                background: white;
                padding: 40px;
                border-radius: 12px;
                text-align: center;
                max-width: 500px;
                width: 90%;
                box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            }

            .k8s-disclaimer-content h2 {
                color: #1a237e;
                margin-top: 0;
                margin-bottom: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 12px;
            }

            .k8s-icon {
                width: 32px;
                height: 32px;
                background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE2IDJMMjggMTBWMjJMMTYgMzBMNCAyMlYxMEwxNiAyWiIgZmlsbD0iIzMyNkNFNSIvPgo8cGF0aCBkPSJNMTYgNkwyNC44IDEyVjIwTDE2IDI2TDcuMiAyMFYxMkwxNiA2WiIgZmlsbD0id2hpdGUiLz4KPHA+PC9wYXRoPgo8L3N2Zz4K') center/contain no-repeat;
            }

            .k8s-disclaimer-content p {
                color: #555;
                line-height: 1.6;
                margin-bottom: 16px;
                font-size: 16px;
            }

            .k8s-disclaimer-content .warning-text {
                background: #fff3cd;
                border: 1px solid #ffeaa7;
                border-radius: 8px;
                padding: 16px;
                color: #856404;
                font-weight: 500;
                margin-bottom: 24px;
            }

            .k8s-disclaimer-buttons {
                display: flex;
                gap: 12px;
                justify-content: center;
            }

            .k8s-disclaimer-content button {
                background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 500;
                transition: all 0.2s ease;
                font-size: 16px;
            }

            .k8s-disclaimer-content button:hover {
                background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
            }

            /* Resource usage indicators */
            .resource-text {
                font-family: 'Roboto Mono', monospace;
                background: #f0f0f0;
                padding: 8px 12px;
                border-radius: 4px;
                font-size: 14px;
                color: #333;
            }

            /* Responsive design */
            @media (max-width: 768px) {
                .sidebar {
                    width: 100%;
                    max-width: 300px;
                    position: absolute;
                    left: -100%;
                    transition: left 0.3s ease;
                    z-index: 1000;
                }

                .sidebar.open {
                    left: 0;
                }

                .header-title {
                    font-size: 18px;
                }

                .timer-display {
                    font-size: 14px;
                    padding: 6px 12px;
                }

                .cheat-sheet-container {
                    flex-direction: column;
                    height: 80vh;
                }

                .cheat-sidebar {
                    width: 100%;
                    height: 150px;
                    border-right: none;
                    border-bottom: 1px solid #e0e0e0;
                }
            }

            /* Hide Angular Material default styling conflicts */
            md-sidenav {
                display: none !important;
            }

            .drop-box.dragover {
                background: rgba(33, 150, 243, 0.1);
                border: 2px dashed #2196f3;
            }

            /* Terminal scrollbar fix */
            .xterm-viewport {
                overflow-y: auto !important;
                scrollbar-width: none; /* Firefox */
            }

            .xterm-viewport::-webkit-scrollbar {
                display: none; /* Chrome, Safari */
            }
        </style>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89019737-3"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-89019737-3');
        </script>
    </head>
    <body>
        <!-- Main Container -->
        <div layout="column" style="height:100%;" ng-cloak>
            
            <!-- Session Ended Screen -->
            <section id="sessionEnd" ng-if="!isAlive" class="session-ended">
              <div class="session-ended-content" ng-if="!instances.length">
                <h2>Your session has expired.</h2>
                <p>Please start a new session to continue.</p>
              </div>
            </section>

            <!-- Session Timeout Modal -->
            <section ng-if="showTimeoutModal" class="session-timeout-modal">
                <div class="session-timeout-content">
                    <h2>Session Timeout</h2>
                    <p>Your session has ended after 15 minutes. All instances have been terminated.</p>
                    <button ng-click="redirectToLanding()">Got It</button>
                </div>
            </section>

            <!-- Kubernetes Disclaimer Modal -->
            <section ng-if="showK8sDisclaimer" class="k8s-disclaimer-modal">
                <div class="k8s-disclaimer-content">
                    <h2>
                        <div class="k8s-icon"></div>
                        Kubernetes Cluster Initialization
                    </h2>
                    <p>Welcome to your Kubernetes playground! This instance is setting up a Kubernetes cluster for you.</p>
                    <div class="warning-text">
                        <strong>⚠️ Please wait approximately 30 seconds</strong><br>
                        The Kubernetes cluster is initializing and will be ready shortly. You can start using kubectl commands once the initialization is complete.
                    </div>
                    <p>You'll see the terminal prompt once everything is ready to use.</p>
                    <div class="k8s-disclaimer-buttons">
                        <button ng-click="closeK8sDisclaimer()">Got It</button>
                    </div>
                </div>
            </section>

            <!-- Main Application -->
            <section ng-if="isAlive">
                <!-- Header -->
                <div class="main-header">
                    <div class="header-left">
                        <h1 class="header-title">Kubernetes Playground</h1>
                    </div>
                    <div class="header-right">
                        <div class="timer-display">{{ttl}}</div>
                        <button class="close-session-btn" ng-click="closeSession()">Close Session</button>
                        <button class="cheat-sheet-btn" ng-click="showCheatSheet()">Cheat Sheet</button>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="main-content">
                    <!-- Sidebar -->
                    <div class="sidebar">
                        <div class="sidebar-header">
                            <div class="sidebar-title">
                                Instances
                            </div>
                            <button class="add-instance-btn" ng-click="newInstance()" ng-disabled="isInstanceBeingCreated">
                                {{newInstanceBtnText || 'Add New Instance'}}
                            </button>
                            <div ng-if="playground.allow_windows_instances" style="margin-top: 12px;">
                                <md-switch ng-model="type.windows">
                                    Windows containers
                                </md-switch>
                            </div>
                        </div>
                        
                        <div class="instances-list">
                            <div ng-repeat="instance in instances | orderBy:'hostname'" 
                                 class="instance-item" 
                                 ng-class="instance.name == selectedInstance.name ? 'selected' : ''"
                                 ng-click="showInstance(instance)">
                                <div class="instance-icon" ng-class="(instance.isManager || instance.isK8sManager) ? 'manager' : ''">
                                    {{instance.isManager || instance.isK8sManager ? 'M' : 'W'}}
                                </div>
                                <div class="instance-info">
                                    <h3>{{instance.ip}}</h3>
                                    <h4>{{instance.hostname}}</h4>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Terminal Area -->
                    <div class="terminal-area">
                        <!-- Welcome Screen - Show when no instances exist -->
                        <div ng-if="!instances.length" class="welcome-screen">
                            <h2>Welcome to Kubernetes Playground</h2>
                            <p>Click "Add New Instance" to create your first Kubernetes cluster.</p>
                            <div class="session-info">
                                <strong>Sessions and all their instances are deleted after {{ttl}} minutes.</strong>
                            </div>
                        </div>

                        <!-- Instance Content -->
                        <div ng-repeat="instance in instances" 
                             ng-show="instance.name == selectedInstance.name" 
                             ngf-drop class="drop-box" 
                             ngf-drag-over-class="'dragover'" 
                             ngf-max-size="100000000" 
                             ngf-change="uploadFiles($files, $invalidFiles)" 
                             ngf-multiple="true"
                             style="height: 100%; display: flex; flex-direction: column;">
                            
                            <!-- Instance Details Card -->
                            <div class="instance-card">
                                <div class="instance-card-header">
                                    <div class="instance-card-title">
                                        {{instance.name}}
                                        <button class="k8s-disclaimer-btn" ng-click="showK8sDisclaimer = true">
                                            K8s Info
                                        </button>
                                    </div>
                                    <div class="instance-details">
                                        <div class="detail-item">
                                            <label>IP Address</label>
                                            <input ng-model="instance.ip" type="text" readonly="readonly">
                                        </div>
                                        <div class="detail-item">
                                            <label>Memory</label>
                                            <div ng-if="instance.memory">
                                                <div class="resource-text">{{instance.memory.usage}} / {{instance.memory.limit}} ({{instance.memory.usagePercent}}%)</div>
                                            </div>
                                            <div ng-if="!instance.memory">
                                                <input value="Not available" type="text" readonly="readonly">
                                            </div>
                                        </div>
                                        <div class="detail-item">
                                            <label>CPU</label>
                                            <div ng-if="instance.cpu">
                                                <div class="resource-text">{{instance.cpu.usagePercent}}%</div>
                                            </div>
                                            <div ng-if="!instance.cpu">
                                                <input value="Not available" type="text" readonly="readonly">
                                            </div>
                                        </div>
                                        <div class="detail-item">
                                            <label>Direct URL</label>
                                            <input value="{{instance.proxy_host}}.direct.{{host}}" type="text" readonly="readonly">
                                            <button class="copy-btn" ng-click="copyToClipboard(instance.proxy_host + '.direct.' + host)">
                                                <md-icon style="font-size: 16px;">content_copy</md-icon>
                                            </button>
                                        </div>
                                    </div>
                                    <div ng-if="instance.ports.length" class="detail-item">
                                        <label>Exposed Ports</label>
                                        <div class="port-chips">
                                            <a ng-repeat="port in instance.ports" 
                                               href="{{getProxyUrl(instance, port)}}" 
                                               target="_blank" 
                                               class="port-chip">{{port}}</a>
                                        </div>
                                    </div>
                                    <div ng-if="instance.swarmPorts.length" class="detail-item">
                                        <label>Swarm Ports</label>
                                        <div class="port-chips">
                                            <a ng-repeat="port in instance.swarmPorts" 
                                               href="{{getProxyUrl(instance, port)}}" 
                                               target="_blank" 
                                               class="port-chip">{{port}}</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="instance-actions">
                                    <button class="delete-instance-btn" ng-click="deleteInstance(instance)" ng-disabled="isInstanceBeingDeleted">
                                        {{deleteInstanceBtnText || 'Delete Instance'}}
                                    </button>
                                </div>
                            </div>

                            <!-- Terminal -->
                            <div class="terminal-container container-{{instance.name}}" style="flex: 1;">
                                <div class="terminal-instance" id="terminal-{{instance.name}}"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Hidden original sidenav for Angular Material compatibility -->
            <md-sidenav
                class="md-sidenav-left"
                md-component-id="left"
                md-theme="kube"
                md-is-locked-open="false"
                md-whiteframe="4" 
                style="display: none;">
                <md-toolbar class="md-accent md-hue-3">
                  <span class="clock">{{ttl}}</span>
                  <md-button class="md-warn md-raised" ng-click="closeSession()">Close session</md-button>
                  <div class="md-toolbar-tools">
                    <h1 class="md-toolbar-tools">Instances</h1>
                  </div>
                  <div class="md-toolbar-tools" ng-if="playground.allow_windows_instances">
                      <md-switch ng-model="type.windows">
                          Windows containers {{windows}}
                      </md-switch>
                  </div>
                </md-toolbar>
                <md-content layout-padding>
                  <md-button ng-click="newInstance()" ng-disabled="isInstanceBeingCreated" class="md-primary">{{newInstanceBtnText}}</md-button>
                  <md-list class="md-dense" flex>
                    <md-list-item ng-switch on="instance.isManager || instance.isK8sManager" class="md-2-line" ng-repeat="instance in instances | orderBy:'hostname'" ng-click="showInstance(instance)" ng-class="instance.name == selectedInstance.name ? 'selected' : false">
                        <md-icon ng-switch-when="true" style="color: blue" md-svg-icon="person"></md-icon>
                        <md-icon ng-switch-when="false" md-svg-icon="person-outline"></md-icon>
                        <div class="md-list-item-text" layout="column">
                            <h3>{{instance.ip}}</h3>
                            <h4>{{instance.hostname}}</h4>
                        </div>
                        <md-divider ng-if="!$last"></md-divider>
                    </md-list-item>
                  </md-list>
                </md-content>
            </md-sidenav>
        </div>

        <!-- Scripts -->
        <script src="https://unpkg.com/reconnectingwebsocket@1.0.0/reconnecting-websocket.min.js" integrity="sha384-FtJyC+/3fgtPbqlacLHdGwBrmPjKoYBsiqNF5/BEprsnIXB4xtXLCJRx7Xx+TWKP" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/angular@1.5.5/angular.min.js"></script>
        <script src="https://unpkg.com/angular-animate@1.5.5/angular-animate.min.js"></script>
        <script src="https://unpkg.com/angular-aria@1.5.5/angular-aria.min.js"></script>
        <script src="https://unpkg.com/angular-messages@1.5.5/angular-messages.min.js"></script>
        <script src="https://unpkg.com/angular-material@1.1.0/angular-material.min.js"></script>
        <script src="https://cdn.rawgit.com/zenorocha/clipboard.js/master/dist/clipboard.min.js"></script>
        <script src="https://unpkg.com/ngclipboard@2.0.0/dist/ngclipboard.min.js"></script>
        <script src="https://unpkg.com/ng-file-upload@12.2.13/dist/ng-file-upload-all.min.js" integrity="sha384-NbBOS/QuqJqwWOtYg/L3ZDhgl/6GFyvkRMypJQLgoisMPtJiHj5uQ+3bj8V8Muwm" crossorigin="anonymous"></script>
        <script src="/assets/xterm/xterm.js"></script>
        <script src="/assets/xterm/addons/fit/fit.js"></script>
        <script src="/assets/xterm/addons/fullscreen/fullscreen.js"></script>
        <script src="/assets/setup-xterm.js"></script>
        <script src="/assets/attach.js"></script>
        <script src="https://unpkg.com/moment@2.16.0/min/moment.min.js"></script>
        <script src="/assets/app.js"></script>

        <script type="text/javascript" charset="utf-8">
            window.onbeforeunload = function (e) {
                e = e || window.event;
                if (e) {
                    e.returnValue = 'Make sure you saved your session URL';
                }
                return 'Make sure you saved your session URL';
            };

            // Add functions for cheat sheet and other functionality
            angular.module('DockerPlay').run(['$rootScope', '$mdDialog', '$timeout', '$window', function($rootScope, $mdDialog, $timeout, $window) {
                // Set session timeout to 15 minutes (900000 milliseconds)
                $rootScope.sessionDuration = 900000;
                
                // Initialize variables
                $rootScope.showK8sDisclaimer = false;
                $rootScope.isCreatingInitialInstance = false;
                
                // Function to check if K8s cluster is ready
                $rootScope.checkK8sClusterReady = function(instance) {
                    if (!instance || !instance.terminal) return;
                    
                    // Send a kubectl command to check cluster status
                    var checkCommand = 'kubectl cluster-info --request-timeout=5s';
                    instance.terminal.write(checkCommand + '\r');
                    
                    // Monitor for successful response
                    // This is a simplified check - in practice you'd need to parse terminal output
                    return true; // Placeholder
                };

                // Modified disclaimer with cluster status check
                $rootScope.showK8sDisclaimerWithCheck = function(instance) {
                    $rootScope.showK8sDisclaimer = true;
                    $rootScope.currentInstance = instance;
                    
                    // Start checking cluster readiness
                    var checkInterval = setInterval(function() {
                        if ($rootScope.checkK8sClusterReady(instance)) {
                            clearInterval(checkInterval);
                            // Cluster is ready - could update modal content
                        }
                    }, 5000); // Check every 5 seconds
                };

                // Show disclaimer when first instance is shown
                var originalShowInstance = $rootScope.showInstance;
                $rootScope.showInstance = function(instance) {
                    if (originalShowInstance) {
                        originalShowInstance.call(this, instance);
                    }
                    
                    // Show disclaimer for any instance
                    if (instance && !$rootScope.hasShownDisclaimer) {
                        $rootScope.showK8sDisclaimerWithCheck(instance);
                        $rootScope.hasShownDisclaimer = true;
                    }
                };
                
                // Function to create initial instance
                $rootScope.createInitialInstance = function() {
                    $rootScope.isCreatingInitialInstance = true;
                    
                    // Simulate instance creation process
                    $timeout(function() {
                        // This should call your existing newInstance() function
                        if (typeof $rootScope.newInstance === 'function') {
                            $rootScope.newInstance();
                        }
                        $rootScope.isCreatingInitialInstance = false;
                        
                        // Show the K8s disclaimer when the first instance is created
                        $timeout(function() {
                            $rootScope.showK8sDisclaimer = true;
                        }, 1000);
                    }, 2000); // Wait 2 seconds to simulate creation
                };
                
                // Initialize timer
                $rootScope.initTimer = function() {
                    $rootScope.ttl = "15:00";
                    $rootScope.sessionStartTime = new Date().getTime();
                    
                    // Update timer every second
                    $rootScope.timerInterval = setInterval(function() {
                        var elapsed = new Date().getTime() - $rootScope.sessionStartTime;
                        var remaining = Math.max(0, $rootScope.sessionDuration - elapsed);
                        
                        var minutes = Math.floor(remaining / 60000);
                        var seconds = Math.floor((remaining % 60000) / 1000);
                        
                        $rootScope.ttl = (minutes < 10 ? "0" : "") + minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
                        
                        // Force Angular to update the view
                        if (!$rootScope.$phase) {
                            $rootScope.$apply();
                        }
                        
                        // Check if session has ended
                        if (remaining <= 0) {
                            $rootScope.closeSession(true);
                        }
                    }, 1000);
                };
                
                // Close session function
                $rootScope.closeSession = function(timeout) {
                    clearInterval($rootScope.timerInterval);
                    
                    if (timeout) {
                        $rootScope.showTimeoutModal = true;
                    } else {
                        $rootScope.isAlive = false;
                        // Additional cleanup logic here
                    }
                };
                
                // Redirect to landing page
                $rootScope.redirectToLanding = function() {
                    $window.location.href = "/"; // Change to your landing page URL
                };
                
                // Copy to clipboard function
                $rootScope.copyToClipboard = function(text) {
                    var textArea = document.createElement("textarea");
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand("copy");
                    document.body.removeChild(textArea);
                    
                    // Show notification
                    $mdDialog.show(
                        $mdDialog.alert()
                            .title('Copied!')
                            .textContent('URL copied to clipboard')
                            .ok('OK')
                    );
                };
                
                // Initialize the timer when the app starts
                $rootScope.initTimer();
                
                // Check for existing instances first, then create initial instance if needed
                $timeout(function() {
                    // Wait longer to check if PWD has any existing instances
                    if ($rootScope.isAlive && (!$rootScope.instances || $rootScope.instances.length === 0)) {
                        // Show disclaimer immediately, then create instance
                        $rootScope.showK8sDisclaimer = true;
                        $rootScope.createInitialInstance();
                    } else if ($rootScope.instances && $rootScope.instances.length > 0) {
                        // If instances already exist, just show the disclaimer
                        $rootScope.showK8sDisclaimer = true;
                    }
                }, 3000); // Increased delay to let PWD initialize
                
                // Function to execute commands in the terminal
                $rootScope.executeCommand = function(command) {
                    if ($rootScope.selectedInstance && $rootScope.selectedInstance.terminal) {
                        var term = $rootScope.selectedInstance.terminal;
                        term.write(command + '\r');
                    } else {
                        console.error('No terminal available for selected instance');
                    }
                };
                
                // Cheat sheet with categories
                $rootScope.showCheatSheet = function() {
                    $mdDialog.show({
                        controller: function($scope, $mdDialog) {
                            $scope.topics = [
                                {
                                    name: "Getting Started",
                                    commands: [
                                        {
                                            code: "kubectl version",
                                            description: "Check client and server version",
                                            output: "Client Version: v1.25.0\nServer Version: v1.25.0"
                                        },
                                        {
                                            code: "kubectl cluster-info",
                                            description: "Display cluster information"
                                        },
                                        {
                                            code: "kubectl get nodes",
                                            description: "List all nodes in the cluster"
                                        }
                                    ]
                                },
                                {
                                    name: "Working with Pods",
                                    commands: [
                                        {
                                            code: "kubectl get pods",
                                            description: "List all pods in the current namespace"
                                        },
                                        {
                                            code: "kubectl describe pod <pod-name>",
                                            description: "Show detailed information about a pod"
                                        },
                                        {
                                            code: "kubectl logs <pod-name>",
                                            description: "Show logs from a pod"
                                        }
                                    ]
                                },
                                {
                                    name: "Deployments",
                                    commands: [
                                        {
                                            code: "kubectl create deployment nginx --image=nginx",
                                            description: "Create a deployment"
                                        },
                                        {
                                            code: "kubectl get deployments",
                                            description: "List all deployments"
                                        },
                                        {
                                            code: "kubectl scale deployment nginx --replicas=3",
                                            description: "Scale a deployment"
                                        }
                                    ]
                                },
                                {
                                    name: "Services",
                                    commands: [
                                        {
                                            code: "kubectl expose deployment nginx --port=80 --type=NodePort",
                                            description: "Expose a deployment as a service"
                                        },
                                        {
                                            code: "kubectl get services",
                                            description: "List all services"
                                        }
                                    ]
                                },
                                {
                                    name: "Configuration",
                                    commands: [
                                        {
                                            code: "kubectl apply -f config.yaml",
                                            description: "Apply configuration from a file"
                                        },
                                        {
                                            code: "kubectl get configmaps",
                                            description: "List all config maps"
                                        }
                                    ]
                                }
                            ];
                            
                            $scope.activeTopic = $scope.topics[0];
                            
                            $scope.setActiveTopic = function(topic) {
                                $scope.activeTopic = topic;
                            };
                            
                            $scope.copyCommand = function(command) {
                                var textArea = document.createElement("textarea");
                                textArea.value = command;
                                document.body.appendChild(textArea);
                                textArea.select();
                                document.execCommand("copy");
                                document.body.removeChild(textArea);
                                
                                // Show notification
                                $mdDialog.show(
                                    $mdDialog.alert()
                                        .title('Copied!')
                                        .textContent('Command copied to clipboard')
                                        .ok('OK')
                                );
                            };
                            
                            $scope.close = function() {
                                $mdDialog.hide();
                            };
                        },
                        template: `
                            <md-dialog aria-label="Kubernetes Cheat Sheet" style="max-width: 1000px; height: 80vh;">
                                <md-toolbar>
                                    <div class="md-toolbar-tools">
                                        <h2>Kubernetes Cheat Sheet</h2>
                                        <span flex></span>
                                        <md-button class="md-icon-button" ng-click="close()">
                                            <md-icon>close</md-icon>
                                        </md-button>
                                    </div>
                                </md-toolbar>
                                <md-dialog-content>
                                    <div class="cheat-sheet-container">
                                        <div class="cheat-sidebar">
                                            <div ng-repeat="topic in topics" 
                                                 class="cheat-sidebar-item" 
                                                 ng-class="{'active': activeTopic === topic}"
                                                 ng-click="setActiveTopic(topic)">
                                                {{topic.name}}
                                            </div>
                                        </div>
                                        <div class="cheat-content">
                                            <div ng-repeat="command in activeTopic.commands" class="cheat-command">
                                                <div class="command-desc">{{command.description}}</div>
                                                <code class="command-code">{{command.code}}</code>
                                                <div class="command-actions">
                                                    <button class="command-btn" ng-click="copyCommand(command.code)">Copy</button>
                                                </div>
                                                <div ng-if="command.output" style="margin-top: 10px;">
                                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Example output:</div>
                                                    <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 12px; margin: 0;">{{command.output}}</pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </md-dialog-content>
                            </md-dialog>
                        `,
                        parent: angular.element(document.body),
                        clickOutsideToClose: true,
                        fullscreen: false
                    });
                };
                
                // This ensures our 15-minute timer takes precedence
                $timeout(function() {
                    // Reinitialize timer to make sure it's set to 15 minutes
                    if ($rootScope.timerInterval) {
                        clearInterval($rootScope.timerInterval);
                    }
                    $rootScope.initTimer();
                }, 1000);
            }]);
        </script>
    </body>
</html>