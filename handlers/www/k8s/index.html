<!doctype html>
<html ng-app="DockerPlay" ng-controller="PlayController">
    <head>
        <title>Kubernetes Playground</title>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic|Material+Icons" />
        <link rel="stylesheet" href="https://unpkg.com/angular-material@1.1.10/angular-material.min.css">
        <link rel="stylesheet" href="/assets/xterm/xterm.css" />
         <link rel="stylesheet" href="/assets/xterm/addons/fullscreen/fullscreen.css" />
        <!-- Custom CSS for Kubernetes styling -->
        <style>
            /* Global Kubernetes theme */
            body {
                font-family: 'Roboto', sans-serif;
                margin: 0;
                padding: 0;
                background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
                height: 100vh;
                overflow: hidden;
            }

            /* Header styling */
            .main-header {
                background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
                color: white;
                padding: 16px 24px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                z-index: 1000;
                position: relative;
            }

            .header-left {
                display: flex;
                align-items: center;
                gap: 16px;
            }

            .k8s-logo {
                width: 32px;
                height: 32px;
                background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE2IDJMMjggMTBWMjJMMTYgMzBMNCAyMlYxMEwxNiAyWiIgZmlsbD0iIzMyNkNFNSIvPgo8cGF0aCBkPSJNMTYgNkwyNC44IDEyVjIwTDE2IDI2TDcuMiAyMFYxMkwxNiA2WiIgZmlsbD0id2hpdGUiLz4KPHA+PC9wYXRoPgo8L3N2Zz4K') center/contain no-repeat;
            }

            .header-title {
                font-size: 24px;
                font-weight: 500;
                margin: 0;
            }

            .header-right {
                display: flex;
                align-items: center;
                gap: 16px;
            }

            .timer-display {
                font-family: 'Roboto Mono', monospace;
                font-size: 18px;
                font-weight: bold;
                background: rgba(255,255,255,0.2);
                padding: 8px 16px;
                border-radius: 20px;
                min-width: 80px;
                text-align: center;
            }

            .close-session-btn {
                background: #f44336 !important;
                color: white !important;
                border: none !important;
                padding: 10px 20px !important;
                border-radius: 6px !important;
                font-weight: 500 !important;
                transition: all 0.3s ease !important;
            }

            .close-session-btn:hover {
                background: #d32f2f !important;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
            }

            /* Main content layout */
            .main-content {
                display: flex;
                height: calc(100vh - 72px);
            }

            /* Sidebar styling */
            .sidebar {
                width: 300px;
                background: white;
                border-right: 1px solid #e0e0e0;
                display: flex;
                flex-direction: column;
                box-shadow: 2px 0 8px rgba(0,0,0,0.1);
            }

            .sidebar-header {
                padding: 20px;
                border-bottom: 1px solid #e0e0e0;
                background: #f8f9fa;
            }

            .sidebar-title {
                font-size: 18px;
                font-weight: 600;
                margin: 0 0 16px 0;
                color: #1a237e;
                text-align: left;
            }

            .add-instance-btn {
                background: #4caf50 !important;
                color: white !important;
                width: 100%;
                padding: 12px !important;
                border-radius: 6px !important;
                font-weight: 500 !important;
                transition: all 0.3s ease !important;
            }

            .add-instance-btn:hover {
                background: #43a047 !important;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
            }

            .add-instance-btn:disabled {
                background: #cccccc !important;
                transform: none !important;
                box-shadow: none !important;
            }

            .instances-list {
                flex: 1;
                overflow-y: auto;
                padding: 0;
            }

            .instance-item {
                padding: 16px 20px;
                border-bottom: 1px solid #f0f0f0;
                cursor: pointer;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .instance-item:hover {
                background: #f5f5f5;
            }

            .instance-item.selected {
                background: #e3f2fd;
                border-left: 4px solid #1976d2;
            }

            .instance-icon {
                width: 24px;
                height: 24px;
                border-radius: 50%;
                background: #1976d2;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 12px;
                font-weight: bold;
            }

            .instance-icon.manager {
                background: #2196f3;
            }

            .instance-info h3 {
                margin: 0 0 4px 0;
                font-size: 14px;
                font-weight: 600;
                color: #333;
            }

            .instance-info h4 {
                margin: 0;
                font-size: 12px;
                color: #666;
                font-weight: normal;
            }

            /* Terminal area styling */
            .terminal-area {
                flex: 1;
                display: flex;
                flex-direction: column;
                background: white;
            }

            .welcome-screen {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-align: center;
                padding: 40px;
                color: #666;
            }

            .welcome-screen h2 {
                color: #1a237e;
                margin-bottom: 16px;
                font-weight: 500;
            }

            .welcome-screen p {
                margin-bottom: 8px;
                line-height: 1.6;
            }

            .welcome-screen .session-info {
                background: #fff3cd;
                border: 1px solid #ffeaa7;
                border-radius: 8px;
                padding: 16px;
                margin-top: 20px;
                color: #856404;
            }

            /* Instance details card */
            .instance-card {
                background: white;
                margin: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                overflow: hidden;
            }

            .instance-card-header {
                background: #f8f9fa;
                padding: 20px;
                border-bottom: 1px solid #e0e0e0;
            }

            .instance-card-title {
                font-size: 20px;
                font-weight: 600;
                color: #1a237e;
                margin: 0 0 16px 0;
            }

            .instance-details {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 16px;
                margin-bottom: 16px;
            }

            .detail-item {
                position: relative;
            }

            .detail-item label {
                display: block;
                font-size: 12px;
                font-weight: 600;
                color: #666;
                margin-bottom: 4px;
                text-transform: uppercase;
            }

            .detail-item input {
                width: calc(100% - 40px);
                padding: 8px 12px;
                border: 1px solid #e0e0e0;
                border-radius: 4px;
                font-size: 14px;
                background: #f8f9fa;
            }

            .copy-btn {
                position: absolute;
                right: 0;
                top: 26px;
                background: #2196f3;
                color: white;
                border: none;
                border-radius: 4px;
                padding: 6px 10px;
                cursor: pointer;
                font-size: 12px;
            }

            .copy-btn:hover {
                background: #1976d2;
            }

            .port-chips {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                margin-top: 8px;
            }

            .port-chip {
                background: #1976d2;
                color: white;
                padding: 4px 12px;
                border-radius: 16px;
                font-size: 12px;
                font-weight: 500;
                text-decoration: none;
                transition: background 0.2s ease;
            }

            .port-chip:hover {
                background: #1565c0;
                color: white;
                text-decoration: none;
            }

            .instance-actions {
                padding: 20px;
                border-top: 1px solid #e0e0e0;
                display: flex;
                gap: 12px;
            }

            .delete-instance-btn {
                background: #f44336 !important;
                color: white !important;
                padding: 10px 20px !important;
                border-radius: 6px !important;
                font-weight: 500 !important;
                transition: all 0.3s ease !important;
            }

            .delete-instance-btn:hover {
                background: #d32f2f !important;
            }

            .delete-instance-btn:disabled {
                background: #cccccc !important;
            }

            .cheat-sheet-btn {
                background: #2196f3 !important;
                color: white !important;
                padding: 10px 20px !important;
                border-radius: 6px !important;
                font-weight: 500 !important;
                transition: all 0.3s ease !important;
            }

            .cheat-sheet-btn:hover {
                background: #1976d2 !important;
            }

            /* Terminal container */
            .terminal-container {
                flex: 1;
                padding: 20px;
                background: #1e1e1e;
                overflow: hidden;
            }

            .terminal-instance {
                width: 100%;
                height: 100%;
                background: #1e1e1e;
            }

            /* Upload progress */
            .upload-status {
                padding: 16px 20px;
                background: #e3f2fd;
                border-bottom: 1px solid #bbdefb;
            }

            /* Session ended screen */
            .session-ended {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                background: white;
            }

            .session-ended-content {
                text-align: center;
                padding: 40px;
            }

            .session-ended h2 {
                color: #f44336;
                margin-bottom: 16px;
            }

            /* Disconnected screen */
            .disconnected {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                color: white;
            }

            .disconnected h1 {
                margin-right: 20px;
            }

            /* Cheat Sheet Styles */
            .cheat-category {
                margin-bottom: 15px;
                border: 1px solid #e0e0e0;
                border-radius: 4px;
                overflow: hidden;
            }

            .cheat-category-header {
                background: #f5f5f5;
                padding: 12px 15px;
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-weight: 500;
            }

            .cheat-category-content {
                padding: 0;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
            }

            .cheat-category-content.expanded {
                max-height: 500px;
                padding: 15px;
            }

            .cheat-command {
                margin-bottom: 10px;
                padding-bottom: 10px;
                border-bottom: 1px solid #eee;
            }

            .cheat-command:last-child {
                margin-bottom: 0;
                padding-bottom: 0;
                border-bottom: none;
            }

            .command-code {
                font-family: monospace;
                background: #f8f9fa;
                padding: 8px;
                border-radius: 4px;
                display: block;
                margin-bottom: 5px;
            }

            .command-desc {
                color: #666;
                font-size: 14px;
            }

            /* Session Timeout Modal */
            .session-timeout-modal {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            }

            .session-timeout-content {
                background: white;
                padding: 30px;
                border-radius: 8px;
                text-align: center;
                max-width: 400px;
                width: 90%;
            }

            .session-timeout-content h2 {
                color: #f44336;
                margin-top: 0;
            }

            .session-timeout-content button {
                background: #2196f3;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                margin-top: 20px;
            }

            /* Responsive design */
            @media (max-width: 768px) {
                .sidebar {
                    width: 100%;
                    max-width: 300px;
                    position: absolute;
                    left: -100%;
                    transition: left 0.3s ease;
                    z-index: 1000;
                }

                .sidebar.open {
                    left: 0;
                }

                .header-title {
                    font-size: 18px;
                }

                .timer-display {
                    font-size: 14px;
                    padding: 6px 12px;
                }
            }

            /* Hide Angular Material default styling conflicts */
            md-sidenav {
                display: none !important;
            }

            .drop-box.dragover {
                background: rgba(33, 150, 243, 0.1);
                border: 2px dashed #2196f3;
            }

            /* Terminal scrollbar fix */
            .xterm-viewport {
                overflow-y: auto !important;
                scrollbar-width: none; /* Firefox */
            }

            .xterm-viewport::-webkit-scrollbar {
                display: none; /* Chrome, Safari */
            }
        </style>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89019737-3"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-89019737-3');
        </script>
    </head>
    <body>
        <!-- Main Container -->
        <div layout="column" style="height:100%;" ng-cloak>
            
            <!-- Session Ended Screen -->
            <section id="sessionEnd" ng-if="!isAlive" class="session-ended">
              <div class="session-ended-content" ng-if="!instances.length">
                <h2>Your session has expired.</h2>
                <p>Please start a new session to continue.</p>
              </div>
            </section>

            <!-- Session Timeout Modal -->
            <section ng-if="showTimeoutModal" class="session-timeout-modal">
                <div class="session-timeout-content">
                    <h2>Session Timeout</h2>
                    <p>Your session has ended after 15 minutes. All instances have been terminated.</p>
                    <button ng-click="redirectToLanding()">Got It</button>
                </div>
            </section>

            <!-- Disconnected Screen -->
            <section ng-if="!connected" class="disconnected">
                <h1>No connection to server. Reconnecting...</h1>
                <md-progress-circular class="md-hue-2" md-diameter="20px"></md-progress-circular>
            </section>

            <!-- Main Application -->
            <section ng-if="isAlive">
                <!-- Header -->
                <div class="main-header">
                    <div class="header-left">
                        <div class="k8s-logo"></div>
                        <h1 class="header-title">Kubernetes Playground</h1>
                    </div>
                    <div class="header-right">
                        <div class="timer-display">{{ttl}}</div>
                        <button class="close-session-btn" ng-click="closeSession()">Close Session</button>
                        <button class="cheat-sheet-btn" ng-click="showCheatSheet()">Cheat Sheet</button>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="main-content">
                    <!-- Sidebar -->
                    <div class="sidebar">
                        <div class="sidebar-header">
                            <div class="sidebar-title">
                                Instances
                            </div>
                            <button class="add-instance-btn" ng-click="newInstance()" ng-disabled="isInstanceBeingCreated">
                                {{newInstanceBtnText || 'Add New Instance'}}
                            </button>
                            <div ng-if="playground.allow_windows_instances" style="margin-top: 12px;">
                                <md-switch ng-model="type.windows">
                                    Windows containers
                                </md-switch>
                            </div>
                        </div>
                        
                        <div class="instances-list">
                            <div ng-repeat="instance in instances | orderBy:'hostname'" 
                                 class="instance-item" 
                                 ng-class="instance.name == selectedInstance.name ? 'selected' : ''"
                                 ng-click="showInstance(instance)">
                                <div class="instance-icon" ng-class="(instance.isManager || instance.isK8sManager) ? 'manager' : ''">
                                    {{instance.isManager || instance.isK8sManager ? 'M' : 'W'}}
                                </div>
                                <div class="instance-info">
                                    <h3>{{instance.ip}}</h3>
                                    <h4>{{instance.hostname}}</h4>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Terminal Area -->
                    <div class="terminal-area">
                        <!-- Welcome Screen -->
                        <div ng-if="!instances.length" class="welcome-screen">
                            <h2>Welcome to Kubernetes Playground</h2>
                            <p>Add instances to your playground to get started.</p>
                            <div class="session-info">
                                <strong>Sessions and all their instances are deleted after {{ttl}} minutes.</strong>
                            </div>
                        </div>

                        <!-- Instance Content -->
                        <div ng-repeat="instance in instances" 
                             ng-show="instance.name == selectedInstance.name" 
                             ngf-drop class="drop-box" 
                             ngf-drag-over-class="'dragover'" 
                             ngf-max-size="100000000" 
                             ngf-change="uploadFiles($files, $invalidFiles)" 
                             ngf-multiple="true"
                             style="height: 100%; display: flex; flex-direction: column;">
                            
                            <!-- Instance Details Card -->
                            <div class="instance-card">
                                <div class="instance-card-header">
                                    <div class="instance-card-title">{{instance.name}}</div>
                                    <div class="instance-details">
                                        <div class="detail-item">
                                            <label>IP Address</label>
                                            <input ng-model="instance.ip" type="text" readonly="readonly">
                                        </div>
                                        <div class="detail-item">
                                            <label>Memory</label>
                                            <input ng-model="instance.memory || 'Not available'" type="text" readonly="readonly">
                                        </div>
                                        <div class="detail-item">
                                            <label>CPU</label>
                                            <input ng-model="instance.cpu || 'Not available'" type="text" readonly="readonly">
                                        </div>
                                        <div class="detail-item">
                                            <label>Direct URL</label>
                                            <input value="{{instance.proxy_host}}.direct.{{host}}" type="text" readonly="readonly">
                                            <button class="copy-btn" ng-click="copyToClipboard(instance.proxy_host + '.direct.' + host)">Copy</button>
                                        </div>
                                    </div>
                                    <div ng-if="instance.ports.length" class="detail-item">
                                        <label>Exposed Ports</label>
                                        <div class="port-chips">
                                            <a ng-repeat="port in instance.ports" 
                                               href="{{getProxyUrl(instance, port)}}" 
                                               target="_blank" 
                                               class="port-chip">{{port}}</a>
                                        </div>
                                    </div>
                                    <div ng-if="instance.swarmPorts.length" class="detail-item">
                                        <label>Swarm Ports</label>
                                        <div class="port-chips">
                                            <a ng-repeat="port in instance.swarmPorts" 
                                               href="{{getProxyUrl(instance, port)}}" 
                                               target="_blank" 
                                               class="port-chip">{{port}}</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="instance-actions">
                                    <button class="delete-instance-btn" ng-click="deleteInstance(instance)" ng-disabled="isInstanceBeingDeleted">
                                        {{deleteInstanceBtnText || 'Delete Instance'}}
                                    </button>
                                </div>
                            </div>

                            <!-- Upload Progress -->
                            <div ng-show="uploadMessage" class="upload-status">
                                <md-progress-linear md-mode="determinate" value="{{uploadProgress}}"></md-progress-linear>
                                <div style="margin-top: 8px;">
                                    <span>{{uploadMessage}}</span>
                                </div>
                            </div>

                            <!-- Reconnection Status -->
                            <div ng-show="instance.status=='reconnect'" class="upload-status">
                                Connection has been lost. Sometimes this happens when a windows instance is joining a swarm. Trying to reconnect terminal...
                            </div>

                            <!-- Terminal -->
                            <div class="terminal-container container-{{instance.name}}" style="flex: 1;">
                                <div class="terminal-instance" id="terminal-{{instance.name}}"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Hidden original sidenav for Angular Material compatibility -->
            <md-sidenav
                class="md-sidenav-left"
                md-component-id="left"
                md-theme="kube"
                md-is-locked-open="false"
                md-whiteframe="4" 
                style="display: none;">
                <md-toolbar class="md-accent md-hue-3">
                  <span class="clock">{{ttl}}</span>
                  <md-button class="md-warn md-raised" ng-click="closeSession()">Close session</md-button>
                  <div class="md-toolbar-tools">
                    <h1 class="md-toolbar-tools">Instances</h1>
                  </div>
                  <div class="md-toolbar-tools" ng-if="playground.allow_windows_instances">
                      <md-switch ng-model="type.windows">
                          Windows containers {{windows}}
                      </md-switch>
                  </div>
                </md-toolbar>
                <md-content layout-padding>
                  <md-button ng-click="newInstance()" ng-disabled="isInstanceBeingCreated" class="md-primary">{{newInstanceBtnText}}</md-button>
                  <md-list class="md-dense" flex>
                    <md-list-item ng-switch on="instance.isManager || instance.isK8sManager" class="md-2-line" ng-repeat="instance in instances | orderBy:'hostname'" ng-click="showInstance(instance)" ng-class="instance.name == selectedInstance.name ? 'selected' : false">
                        <md-icon ng-switch-when="true" style="color: blue" md-svg-icon="person"></md-icon>
                        <md-icon ng-switch-when="false" md-svg-icon="person-outline"></md-icon>
                        <div class="md-list-item-text" layout="column">
                            <h3>{{instance.ip}}</h3>
                            <h4>{{instance.hostname}}</h4>
                        </div>
                        <md-divider ng-if="!$last"></md-divider>
                    </md-list-item>
                  </md-list>
                </md-content>
            </md-sidenav>
        </div>

        <!-- Scripts -->
        <script src="https://unpkg.com/reconnectingwebsocket@1.0.0/reconnecting-websocket.min.js" integrity="sha384-FtJyC+/3fgtPbqlacLHdGwBrmPjKoYBsiqNF5/BEprsnIXB4xtXLCJRx7Xx+TWKP" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/angular@1.5.5/angular.min.js"></script>
        <script src="https://unpkg.com/angular-animate@1.5.5/angular-animate.min.js"></script>
        <script src="https://unpkg.com/angular-aria@1.5.5/angular-aria.min.js"></script>
        <script src="https://unpkg.com/angular-messages@1.5.5/angular-messages.min.js"></script>
        <script src="https://unpkg.com/angular-material@1.1.0/angular-material.min.js"></script>
        <script src="https://cdn.rawgit.com/zenorocha/clipboard.js/master/dist/clipboard.min.js"></script>
        <script src="https://unpkg.com/ngclipboard@2.0.0/dist/ngclipboard.min.js"></script>
        <script src="https://unpkg.com/ng-file-upload@12.2.13/dist/ng-file-upload-all.min.js" integrity="sha384-NbBOS/QuqJqwWOtYg/L3ZDhgl/6GFyvkRMypJQLgoisMPtJiHj5uQ+3bj8V8Muwm" crossorigin="anonymous"></script>
        <script src="/assets/xterm/xterm.js"></script>
        <script src="/assets/xterm/addons/fit/fit.js"></script>
        <script src="/assets/xterm/addons/fullscreen/fullscreen.js"></script>
        <script src="/assets/setup-xterm.js"></script>
        <script src="/assets/attach.js"></script>
        <script src="https://unpkg.com/moment@2.16.0/min/moment.min.js"></script>
        <script src="/assets/app.js"></script>

        <script type="text/javascript" charset="utf-8">
            window.onbeforeunload = function (e) {
                e = e || window.event;
                if (e) {
                    e.returnValue = 'Make sure you saved your session URL';
                }
                return 'Make sure you saved your session URL';
            };

            // Add functions for cheat sheet and other functionality
            angular.module('DockerPlay').run(['$rootScope', '$mdDialog', '$timeout', '$window', function($rootScope, $mdDialog, $timeout, $window) {
                // Set session timeout to 15 minutes (900000 milliseconds)
                $rootScope.sessionDuration = 900000;
                
                // Initialize timer
                $rootScope.initTimer = function() {
                    $rootScope.ttl = "15:00";
                    $rootScope.sessionStartTime = new Date().getTime();
                    
                    // Update timer every second
                    $rootScope.timerInterval = setInterval(function() {
                        var elapsed = new Date().getTime() - $rootScope.sessionStartTime;
                        var remaining = Math.max(0, $rootScope.sessionDuration - elapsed);
                        
                        var minutes = Math.floor(remaining / 60000);
                        var seconds = Math.floor((remaining % 60000) / 1000);
                        
                        $rootScope.ttl = (minutes < 10 ? "0" : "") + minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
                        
                        // Force Angular to update the view
                        if (!$rootScope.$$phase) {
                            $rootScope.$apply();
                        }
                        
                        // Check if session has ended
                        if (remaining <= 0) {
                            $rootScope.closeSession(true);
                        }
                    }, 1000);
                };
                
                // Close session function
                $rootScope.closeSession = function(timeout) {
                    clearInterval($rootScope.timerInterval);
                    
                    if (timeout) {
                        $rootScope.showTimeoutModal = true;
                    } else {
                        $rootScope.isAlive = false;
                        // Additional cleanup logic here
                    }
                };
                
                // Redirect to landing page
                $rootScope.redirectToLanding = function() {
                    $window.location.href = "/"; // Change to your landing page URL
                };
                
                // Copy to clipboard function
                $rootScope.copyToClipboard = function(text) {
                    var textArea = document.createElement("textarea");
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand("copy");
                    document.body.removeChild(textArea);
                    
                    // Show notification
                    $mdDialog.show(
                        $mdDialog.alert()
                            .title('Copied!')
                            .textContent('URL copied to clipboard')
                            .ok('OK')
                    );
                };
                
                // Initialize the timer when the app starts
                $rootScope.initTimer();
                
                // Cheat sheet with categories
                $rootScope.showCheatSheet = function() {
                    $mdDialog.show({
                        controller: function($scope, $mdDialog) {
                            $scope.categories = [
                                {
                                    name: "Basic Commands",
                                    expanded: true,
                                    commands: [
                                        {command: "kubectl get nodes", description: "Check cluster nodes"},
                                        {command: "kubectl get pods -A", description: "List all pods"},
                                        {command: "kubectl create deployment nginx --image=nginx", description: "Create deployment"},
                                        {command: "kubectl expose deployment nginx --port=80 --type=NodePort", description: "Expose service"},
                                        {command: "kubectl get services", description: "List services"}
                                    ]
                                },
                                {
                                    name: "Useful Commands",
                                    expanded: false,
                                    commands: [
                                        {command: "kubectl apply -f <file.yaml>", description: "Apply configuration"},
                                        {command: "kubectl logs <pod-name>", description: "View pod logs"},
                                        {command: "kubectl exec -it <pod-name> -- bash", description: "Enter pod shell"},
                                        {command: "kubectl describe pod <pod-name>", description: "Get pod details"},
                                        {command: "kubectl delete deployment <name>", description: "Delete deployment"}
                                    ]
                                },
                                {
                                    name: "Shortcuts",
                                    expanded: false,
                                    commands: [
                                        {command: "alias k=kubectl", description: "Short alias for kubectl"},
                                        {command: "kubectl completion bash", description: "Enable tab completion"}
                                    ]
                                }
                            ];
                            
                            $scope.toggleCategory = function(category) {
                                category.expanded = !category.expanded;
                            };
                            
                            $scope.close = function() {
                                $mdDialog.hide();
                            };
                        },
                        template: `
                            <md-dialog aria-label="Kubernetes Cheat Sheet" style="max-width: 800px;">
                                <md-toolbar>
                                    <div class="md-toolbar-tools">
                                        <h2>Kubernetes Cheat Sheet</h2>
                                        <span flex></span>
                                        <md-button class="md-icon-button" ng-click="close()">
                                            <md-icon>close</md-icon>
                                        </md-button>
                                    </div>
                                </md-toolbar>
                                <md-dialog-content>
                                    <div class="md-dialog-content" style="max-height: 70vh;">
                                        <div ng-repeat="category in categories" class="cheat-category">
                                            <div class="cheat-category-header" ng-click="toggleCategory(category)">
                                                <span>{{category.name}}</span>
                                                <md-icon>{{category.expanded ? 'expand_less' : 'expand_more'}}</md-icon>
                                            </div>
                                            <div class="cheat-category-content" ng-class="{'expanded': category.expanded}">
                                                <div ng-repeat="cmd in category.commands" class="cheat-command">
                                                    <code class="command-code">{{cmd.command}}</code>
                                                    <div class="command-desc">{{cmd.description}}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </md-dialog-content>
                            </md-dialog>
                        `,
                        parent: angular.element(document.body),
                        clickOutsideToClose: true,
                        fullscreen: false
                    });
                };
            }]);
        </script>
    </body>
</html>